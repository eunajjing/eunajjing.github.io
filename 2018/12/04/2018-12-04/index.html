<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <meta name="keywords" content="hexo, autumn">
    <title>
        ERecord
    </title>
    <!-- favicon -->
    
    <link rel="icon" href="http://osly086qe.bkt.clouddn.com/favicon.ico">
    
    <link rel="stylesheet" href="/css/style.css">

    <!-- highlight -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.12.0/styles/github-gist.min.css">
    <script src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js"></script>
    <script>
        hljs.initHighlightingOnLoad()
    </script>
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="http://osly086qe.bkt.clouddn.com/hexo-infinite-scroll-v1.0.1.min.css">
    <script src="http://osly086qe.bkt.clouddn.com/hexo-infinite-scroll-v1.0.3.min.js"></script>
    <script>
        infiniteScroll()

        // for mobile menu
        $(function() {
            $('.social-button').click(function() {
                if ($('.social-links').hasClass('hide-links')) {
                    $('.social-links').removeClass('hide-links')
                } else {
                    $('.social-links').addClass('hide-links')
                }
            })
        })
    </script>
</head>

    <body style="background: url(http://osly086qe.bkt.clouddn.com/button-bg.png) #f3f3f3">
        <div class="container">
            <header class="header">
    <h1 class="title">
        <a href="/" class="logo">
            ERecord
        </a>
    </h1>
    <h2 class="desc">
        일상 및 개발 공부 기록용 블로그
    </h2>

    <nav class="links">
        <button class="social-button">
            menu
        </button>
        <ul class="social-links hide-links">
                <li>
                    <a href="https://github.com/eunajjing">GITHUB
                    </a>
                </li>
<li><a href="https://uri.life/web/accounts/8579">CONNECTING</a>
</li>
        </ul>
    </nav>
</header>

                <main class="main">
                    <article class="post">
    
        <h4 class="post-cat">
            <a href="/categories/개발공부/">
                개발공부
            </a>
        </h4>
        
        <h4 class="post-cat">
            <a href="/categories/개발공부/뉴딜과정/">
                뉴딜과정
            </a>
        </h4>
        
            <h2 class="post-title">
                2018-12-04 수업 내용 정리
            </h2>
            <ul class="post-date">
                <li>
                    2018-12-04
                </li>
                <li>
                    euna
                </li>
            </ul>
            <div class="post-content">
                <ul>
<li><p>리턴 값은 프로그램의 유연성을 위해 인터페이스 자료형으로 한다.</p>
</li>
<li><p>try-with-resources</p>
<ul>
<li><p>자바 버전 7에 추가된 기능으로 try에 자원 객체를 전달하면 finally 블록으로 close 처리를 하지 않아도, try 코드 블록이 끝나면 자동으로 자원을 종료해주는 기능</p>
</li>
<li><p>closeable 인터페이스를 상속한 객체만이 try 소괄호 안으로 들어올 수 있다</p>
</li>
<li><p>만약 해당 인터페이스를 상속 받지 못했다면 try 구문에 올 수 없다</p>
</li>
<li><p>try 문의 존재 이유가 finally이기 때문에 try-with-resources로 구현했다면 굳이 catch 문을 구현하지 않는다. 이 경우 메서드에서 예외처리가 같이 명시되어 있어야 한다.</p>
</li>
<li><p>PreparedStatement로 쿼리문을 날릴 때, ‘? 처리가 try 소괄호 안에서 처리가 불가능하다</p>
<ul>
<li><p>이 경우에는 set을 try 구문 안(중괄호 속)에서 입력</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public Board findByNo(int no) throws Exception &#123;</span><br><span class="line">  DriverManager.registerDriver(new Driver());</span><br><span class="line">  try (</span><br><span class="line">      Connection con = DriverManager.getConnection(&quot;jdbc:mariadb://localhost:3306/studydb&quot;, &quot;study&quot;, &quot;1111&quot;);</span><br><span class="line">      PreparedStatement stmt = con.prepareStatement(</span><br><span class="line">          &quot;select bno, cont, cdt, view, mno, lno&quot; + &quot; from board where bno=?&quot;);) &#123;</span><br><span class="line">    stmt.setInt(1, no);</span><br><span class="line">    try (ResultSet rs = stmt.executeQuery()) &#123;</span><br><span class="line">      if (rs.next()) &#123;</span><br><span class="line">        Board board = new Board();</span><br><span class="line">        board.setNo(rs.getInt(&quot;bno&quot;));</span><br><span class="line">        board.setContents(rs.getString(&quot;cont&quot;));</span><br><span class="line">        board.setCreatedDate(rs.getDate(&quot;cdt&quot;));</span><br><span class="line">        board.setViewCount(rs.getInt(&quot;view&quot;));</span><br><span class="line">        board.setWriterNo(rs.getInt(&quot;mno&quot;));</span><br><span class="line">        board.setLessonNo(rs.getInt(&quot;lno&quot;));</span><br><span class="line">        return board;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        return null;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>만약 try 소괄호 안, 마지막 구문은 <strong>세미콜론 생략</strong>이 가능하다</p>
</li>
</ul>
</li>
<li><p>만약 try 문을 구현한 메서드에서 예외를 던지게 설정되어 있다면 (throws Exception) catch 블록을 따로 구현할 필요가 없다.</p>
</li>
</ul>
<h2 id="MyBatis-적용"><a href="#MyBatis-적용" class="headerlink" title="MyBatis 적용"></a>MyBatis 적용</h2><ol>
<li><p>gradle에 의존 설정을 해준 뒤 <code>gradle eclipse</code> 실행해 설정 파일 갱신</p>
</li>
<li><p><code>src/main/resources/자바경로/comf</code>에 <code>mybatis-config.xml</code>를 둔다.<br>  <code>resources</code>가 없으면 생성</p>
<p><code>mybatis-config.xml</code>에 자바 소스 폴더로 등록 후 <code>gradle eclipse</code> 재실행</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">  PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span><br><span class="line">  &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;environments default=&quot;development&quot;&gt;</span><br><span class="line">    &lt;environment id=&quot;development&quot;&gt;</span><br><span class="line">      &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">      &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;driver&quot; value=&quot;$&#123;driver&#125;&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;url&quot; value=&quot;$&#123;url&#125;&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;username&quot; value=&quot;$&#123;username&#125;&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;password&quot; value=&quot;$&#123;password&#125;&quot;/&gt;</span><br><span class="line">      &lt;/dataSource&gt;</span><br><span class="line">    &lt;/environment&gt;</span><br><span class="line">  &lt;/environments&gt;</span><br><span class="line">  &lt;mappers&gt;</span><br><span class="line">    &lt;mapper resource=&quot;org/mybatis/example/BlogMapper.xml&quot;/&gt;</span><br><span class="line">  &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>jdbc.properties</code> 파일 작성해서 해당 프로퍼티가 안으로 들어갈 수 있도록 설정</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jdbc.driver=org.mariadb.jdbc.Driver</span><br><span class="line">jdbc.url=jdbc:mariadb://localhost:3306/studydb</span><br><span class="line">jdbc.username=study</span><br><span class="line">jdbc.password=1111</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;-- xml은 이렇게 수정된다 --&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">&lt;-- properties의 경로 설정해준다--&gt;</span><br><span class="line">&lt;properties resource=&quot;com/eomcs/lms/conf/jdbc.properties&quot;&gt;&lt;/properties&gt;</span><br><span class="line">&lt;-- db 연결 정보를 설정, default는 아래와 같다</span><br><span class="line">	즉 db 연결 정보를 여러 개 설정할 수 있다 --&gt;</span><br><span class="line">  &lt;environments default=&quot;development&quot;&gt;</span><br><span class="line">    &lt;environment id=&quot;development&quot;&gt;</span><br><span class="line">    &lt;-- 트랜젝션 관리는 jdbc를 쓰겠다 --&gt;</span><br><span class="line">      &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">      &lt;-- db 커넥션 풀 --&gt;</span><br><span class="line">      &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;driver&quot; value=&quot;$&#123;jdbc.driver&#125;&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc.username&#125;&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot;/&gt;</span><br><span class="line">        &lt;-- value와 프로퍼티 파일의 이름이 같아야 한다 --&gt;</span><br><span class="line">      &lt;/dataSource&gt;</span><br><span class="line">    &lt;/environment&gt;</span><br><span class="line">  &lt;/environments&gt;</span><br><span class="line">  &lt;-- sql을 보관할 xml 파일 경로 설정 --&gt;</span><br><span class="line">  &lt;mappers&gt;</span><br><span class="line">    &lt;mapper resource=&quot;com/eomcs/lms/mapper/BoardMapper.xml&quot;/&gt;</span><br><span class="line">  &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>src/main/resources/자바경로/mapper/BoardMapper.xml</code>에 파일 작성(sql문들)</p>
</li>
<li><p>실행 클래스에서 mybatis의 <code>SqlSessionFactory</code> 객체 준비</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">String resource = &quot;com/eomcs/lmes/conf/mybatis-config.xml&quot;;</span><br><span class="line">&lt;!-- 팩토리 패턴 --&gt;</span><br><span class="line">InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">&lt;!-- 빌더 패턴 --&gt;</span><br><span class="line">SqlSessionFactory sqlSessionFactory =</span><br><span class="line">      new SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">      </span><br><span class="line">BoardDao boardDao = new MariaDBBoardDao(sqlSessionFactory);</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><p>inputStream : 설계도의 역할</p>
</li>
<li><p>SqlSessionFactoryBuilder는 전문적으로 SqlSessionFactory를 만듦</p>
</li>
<li><p>객체 생성 과정이 복잡할 때는 대부분 *Builder 클래스를 활용해 생성 - 빌더 패턴</p>
</li>
<li>디자인 패턴 중 하나인 <strong>빌더 패턴</strong>, <strong>팩토리 패턴</strong></li>
<li>팩토리 패턴은 간단한 조립의 기능 수행, 빌더는 보다 큰 기능을 수행한다</li>
</ul>
</blockquote>
<p>dao가 사용할 수 있도록 생성자에 해당 객체 주입</p>
</li>
<li><p>dao 단에서 세션 생성</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public List&lt;Board&gt; findAll() throws Exception &#123;</span><br><span class="line">   </span><br><span class="line">  try (SqlSession sqlSession = sqlSessionFactory.openSession()) &#123;</span><br><span class="line">    return sqlSession.selectList(&quot;DoardDao.findAll&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>실습 중 에러 기록</p>
<ul>
<li><p>mapper의 namespace 대소문자 오타</p>
</li>
<li><p>인터페이스 상속 받은 메서드 오타</p>
</li>
<li>메서드 실행 시 필요한 파라미터 값 넘기지 않음</li>
<li><strong>gradle eclipse</strong> 실행 후 새로고침 에러</li>
</ul>
</blockquote>
</li>
<li><p>mybatis의 경우 오토커밋이 안되기 때문에 커밋 설정을 따로 해줘야 한다.<br>트랜젝션 관리 때문에 오토커밋을 자동으로 실행하는 옵션을 설정할 수 없다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public int insert(Board board) throws Exception &#123;</span><br><span class="line">    try (SqlSession sqlSession = sqlSessionFactory.openSession()) &#123;</span><br><span class="line">      int count = sqlSession.insert(&quot;BoardDao.insert&quot;, board);</span><br><span class="line">      sqlSession.commit();</span><br><span class="line">      return count;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>별명 지정 가능</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties resource=&quot;com/eomcs/lms/conf/jdbc.properties&quot;&gt;&lt;/properties&gt;</span><br><span class="line">&lt;!-- 프로퍼티 아래로 들어와야 한다 --&gt;</span><br><span class="line">&lt;typeAliases&gt;</span><br><span class="line">  &lt;package name=&quot;com.eomcs.lms.domain&quot;/&gt;</span><br><span class="line">&lt;/typeAliases&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>db 내 컬럼과 domain의 이름이 다를 때<br>매퍼의 상위에 아래 코드를 기술해 지정해주고,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap type=&quot;board&quot; id=&quot;boardMap&quot;&gt;</span><br><span class="line">   &lt;!-- board 칼럼을 프로퍼티 이름과 연결 --&gt;</span><br><span class="line">   &lt;id column=&quot;bno&quot; property=&quot;no&quot;/&gt;</span><br><span class="line">   &lt;!-- pk는 result가 아니라 id로 해줘야 한다 --&gt;</span><br><span class="line">   &lt;result column=&quot;cont&quot; property=&quot;contents&quot;/&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br></pre></td></tr></table></figure>
<p>sql 태그에서 파라미터맵이나, resultMap으로 위를 가리켜 실행</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;findAll&quot; resultMap=&quot;boardMap&quot;&gt;</span><br><span class="line">    select bno, cont, cdt, view from board</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>

            </div>
</article>

                </main>
                <aside class="aside">
                    <section class="aside-section">
                        
    <h1>Categories</h1>

    <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/개발공부/">개발공부</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/개발공부/nodeJS/">nodeJS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/개발공부/뉴딜과정/">뉴딜과정</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/개발공부/몽고DB/">몽고DB</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/개발공부/정보처리기사/">정보처리기사</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/일상/">일상</a></li></ul>

                    </section>
                    <section class="aside-section">
                        
    <h1>Archives</h1>

    <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">2018</a></li></ul>


                    </section>
                    <section class="aside-section tag">
                        
    <h1>Tags</h1>

    

                    </section>
                </aside>
        </div>
    </body>

</html>